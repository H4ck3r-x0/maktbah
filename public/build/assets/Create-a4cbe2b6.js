import{q as _,W as K,r as n,j as l,a,d as M,b as R,f}from"./app-cb4316c3.js";import{P as b}from"./PrimaryButton-da87da90.js";import{A as T}from"./AuthenticatedLayout-f050c8ea.js";import{D as w}from"./DangerButton-4c28199a.js";import{S as U}from"./SecondaryButton-906b8e0d.js";import{d as X}from"./debounce-e91e51ba.js";import Y from"./Pagination-73db2e5e.js";import{I as Z,_ as g}from"./index-f6e07490.js";import"./AdminAuthenticatedHeader-c96ceacd.js";import"./ApplicationLogo-d330570c.js";import"./transition-3e9f14fd.js";import"./AuthenticatedLibraryHeader-94a27a78.js";function me({auth:S,books:y,addedBooks:m}){const C=_().props.filters,x=_().props.currentPage,{data:u,setData:q,get:P}=K({search:C.search}),[d,o]=n.useState([]),[v,j]=n.useState(""),[N,B]=n.useState(""),[E,D]=n.useState(""),[A,I]=n.useState(null);n.useEffect(()=>{m.length>0&&o(m)},[m]);const V=r=>{q("search",r.target.value)},L=()=>{P(route("book.create",{search:u.search,page:x}),{preserveScroll:!0,preserveState:!0,replace:!0})},p=n.useCallback(X(L,500),[u.search,x]);n.useEffect(()=>(p(),p.cancel),[u.search,p]);const k=(r,i)=>{r.preventDefault();const{book_id:t,qty:s,price:e,offer:J}=d.filter(c=>c.book_id===i)[0];f.post(route("book.update",i),{book_id:t,qty:s,price:e,offer:J},{preserveScroll:!0,onError:c=>{let h="";c.price&&(h=c.price),c.qty&&(h=c.qty),g.error(h,{duration:4e3,position:"top-center",className:"",ariaProps:{role:"status","aria-live":"polite"}})}})},F=r=>{if(N===""||v===""){g.error("الرجاء اكمال جميع بيانات الكتاب",{duration:4e3,position:"top-center",className:"",ariaProps:{role:"status","aria-live":"polite"}});return}f.post(route("book.store"),{book_id:r,qty:v,price:N,offer:E,ad_image:A},{preserveScroll:!0,onError:i=>{let t="";i.ad_image&&(t=i.ad_image),i.price&&(t=i.price),i.qty&&(t=i.qty),g.error(t,{duration:4e3,position:"top-center",className:"",ariaProps:{role:"status","aria-live":"polite"}})}})},O=(r,i)=>{r.preventDefault(),f.delete(route("book.destroy",i),{preserveScroll:!0,onSuccess:()=>{o(t=>t.filter(s=>s.book_id!==i))}})},Q=(r,i)=>{r.preventDefault(),f.post(route("book.restore",i),{preserveScroll:!0,onSuccess:()=>{o(t=>t.filter(s=>s.book_id!==i))}})},W=(r,i)=>{const{value:t}=r.target;j(t),t!==""&&o(s=>s.map(e=>e.book_id===i?{...e,qty:t}:e))},z=(r,i)=>{const{value:t}=r.target;B(t),t!==""&&o(s=>s.map(e=>e.book_id===i?{...e,price:t}:e))},G=(r,i)=>{const{value:t}=r.target;D(t),t!==""&&o(s=>s.map(e=>e.book_id===i?{...e,offer:t}:e))},H=(r,i)=>{I(r.target.files[0]),r.target.files[0]&&o(t=>t.map(s=>s.book_id===i?{...s,ad_image:r.target.files[0]}:s))};return l(T,{user:S.user,header:l("div",{className:"flex items-center justify-between",children:[a("h2",{className:"flex flex-col gap-2 font-semibold text-xl text-gray-800 leading-tight",children:a("span",{children:"إضافة كتاب جديد"})}),a(M,{href:route("library.dashboard"),children:a(b,{children:"العودة"})})]}),children:[a(R,{title:"إضافة كتاب جديد"}),l("div",{className:"py-4",children:[a(Z,{}),l("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[a("div",{className:" max-w-full  px-6 ",children:a("div",{className:"flex-1",children:a("input",{className:" w-full p-3 border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",type:"text",id:"search",name:"search",value:u.search||"",onChange:V,autoFocus:!0,placeholder:"ابحث بإسم الكتاب او الكاتب ..."})})}),a("div",{className:" overflow-hidden sm:rounded-lg",children:l("div",{className:"p-6 text-gray-900",children:[a("div",{className:"grid grid-cols-1 sm:grid-cols-2  gap-3",children:y.data.map(r=>{var i,t,s;return a("div",{className:"max-w-lg bg-white border border-gray-200 rounded-lg shadow h-full",children:l("div",{className:"flex flex-col p-5 h-full",children:[a("h5",{className:"mb-1 text-xl font-semibold text-gray-900",children:r.book_name}),a("div",{className:"py-2 flex-1",children:l("ul",{className:"flex itmes-center   gap-2 mb-2",children:[l("li",{className:"mb-2 text-gray-700",children:[a("strong",{className:"text-gray-700",children:"الكاتب:"})," ",r.author_name]}),l("li",{className:"mb-2 text-gray-700",children:[a("strong",{className:"text-gray-700",children:"رقم الطبعة:"})," ",r.edition_number]}),l("li",{className:"text-gray-700",children:[a("strong",{className:"text-gray-700",children:"رقم المجلد:"})," ",r.volume_number]})]})}),l("div",{className:"flex items-center justify-center flex-wrap gap-2",children:[a("input",{onChange:e=>W(e,r.id),type:"number",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((i=d.find(e=>e.book_id===r.id))==null?void 0:i.qty)||"",placeholder:"الكمية"}),a("input",{onChange:e=>z(e,r.id),type:"number",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((t=d.find(e=>e.book_id===r.id))==null?void 0:t.price)||"",placeholder:"السعر"}),a("input",{onChange:e=>G(e,r.id),type:"text",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((s=d.find(e=>e.book_id===r.id))==null?void 0:s.offer)||"",placeholder:"عرض إضافي"}),a("div",{className:"py-4 w-full",children:l("label",{className:"flex items-center justify-center w-full py-2 px-4 border border-gray-300 rounded-md shadow-sm transition duration-300 focus:border-indigo-500 focus:ring-indigo-500 hover:border-indigo-500 focus:outline-none hover:cursor-pointer",children:[a("span",{className:"mr-2",children:"أختر صورة الأعلان"}),a("input",{name:"adImage",onChange:e=>H(e,r.id),type:"file",className:"hidden"})]})})]}),l("div",{className:"flex pt-2",children:[l("div",{className:"flex-1",children:[!m.some(e=>e.book_id==r.id)&&a(b,{onClick:()=>F(r.id),children:"أضف"}),m.some(e=>e.book_id==r.id)&&a(U,{onClick:e=>k(e,r.id),children:"تحديث"})]}),d.some(e=>e.book_id===r.id)&&a("div",{children:d.some(e=>e.book_id===r.id&&e.deleted_at===null)?a(w,{onClick:e=>O(e,r.id),children:"حذف"}):a(w,{onClick:e=>Q(e,r.id),children:"إستعادة"})})]})]})},r.id)})}),a(Y,{links:y.links})]})})]})]})]})}export{me as default};
