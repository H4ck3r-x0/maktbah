import{q as S,W as K,r as c,j as n,a,d as R,b as T,g as f}from"./app-4dcbcd01.js";import{P as y}from"./PrimaryButton-2a1d70c1.js";import{A as U}from"./AuthenticatedLayout-b432783d.js";import{D as C}from"./DangerButton-0ea8b395.js";import{S as X}from"./SecondaryButton-da0fd9c3.js";import{d as Y}from"./debounce-9ee49d3c.js";import Z from"./Pagination-c07de29d.js";import{I as $,_ as x}from"./index-984e4f05.js";import"./AdminAuthenticatedHeader-7810a8a5.js";import"./ApplicationLogo-04acaaec.js";import"./transition-cfef33d3.js";import"./AuthenticatedLibraryHeader-33bf1063.js";function ue({auth:q,books:v,addedBooks:u}){const B=S().props.filters,N=S().props.currentPage,{data:p,setData:P,get:j}=K({search:B.search}),[o,m]=c.useState([]),[b,A]=c.useState(""),[_,D]=c.useState(""),[E,I]=c.useState(""),[w,k]=c.useState(null);c.useEffect(()=>{u.length>0&&m(u)},[u]);const V=e=>{P("search",e.target.value)},L=()=>{j(route("branch.book.create",{search:p.search,page:N}),{preserveScroll:!0,preserveState:!0,replace:!0})},g=c.useCallback(Y(L,500),[p.search,N]);c.useEffect(()=>(g(),g.cancel),[p.search,g]);const F=(e,t)=>{e.preventDefault();const{book_id:i,qty:s,price:l,offer:r}=o.filter(d=>d.book_id===t)[0];f.post(route("branch.book.update",t),{book_id:i,qty:s,price:l,offer:r,ad_image:w},{preserveScroll:!0,onError:d=>{let h="";d.ad_image&&(h=d.ad_image),d.price&&(h=d.price),d.qty&&(h=d.qty),x.error(h,{duration:4e3,position:"top-center",className:"",ariaProps:{role:"status","aria-live":"polite"}})}})},M=e=>{if(_===""||b===""){x.error("الرجاء اكمال جميع بيانات الكتاب",{duration:4e3,position:"top-center",className:"",ariaProps:{role:"status","aria-live":"polite"}});return}f.post(route("branch.book.store"),{book_id:e,qty:b,price:_,offer:E,ad_image:w},{preserveScroll:!0,onError:t=>{let i="";t.ad_image&&(i=t.ad_image),t.price&&(i=t.price),t.qty&&(i=t.qty),x.error(i,{duration:4e3,position:"top-center",className:"",ariaProps:{role:"status","aria-live":"polite"}})}})},O=(e,t)=>{e.preventDefault(),f.delete(route("branch.book.deleteBookAdImage",t),{preserveScroll:!0,onSuccess:()=>{}})},Q=(e,t)=>{e.preventDefault(),f.delete(route("branch.book.destroy",t),{preserveScroll:!0,onSuccess:()=>{m(i=>i.filter(s=>s.book_id!==t))}})},W=(e,t)=>{e.preventDefault(),f.post(route("branch.book.restore",t),{preserveScroll:!0,onSuccess:()=>{m(i=>i.filter(s=>s.book_id!==t))}})},z=(e,t)=>{const{value:i}=e.target;A(i),i!==""&&m(s=>s.map(l=>l.book_id===t?{...l,qty:i}:l))},G=(e,t)=>{const{value:i}=e.target;D(i),i!==""&&m(s=>s.map(l=>l.book_id===t?{...l,price:i}:l))},H=(e,t)=>{const{value:i}=e.target;I(i),i!==""&&m(s=>s.map(l=>l.book_id===t?{...l,offer:i}:l))},J=(e,t)=>{k(e.target.files[0]),e.target.files[0]&&m(i=>i.map(s=>s.book_id===t?{...s,ad_image:e.target.files[0]}:s))};return n(U,{user:q.user,header:n("div",{className:"flex items-center justify-between",children:[a("h2",{className:"flex flex-col gap-2 font-semibold text-xl text-gray-800 leading-tight",children:a("span",{children:"إضافة كتاب جديد"})}),a(R,{href:route("library.dashboard"),children:a(y,{children:"العودة"})})]}),children:[a(T,{title:"إضافة كتاب جديد"}),n("div",{className:"py-4",children:[a($,{}),n("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[a("div",{className:" max-w-full  px-6 ",children:a("div",{className:"flex-1",children:a("input",{className:" w-full p-3 border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",type:"text",id:"search",name:"search",value:p.search||"",onChange:V,autoFocus:!0,placeholder:"ابحث بإسم الكتاب او الكاتب ..."})})}),a("div",{className:" overflow-hidden sm:rounded-lg",children:n("div",{className:"p-6 text-gray-900",children:[a("div",{className:"grid grid-cols-1 sm:grid-cols-2  gap-3",children:v.data.map(e=>{var t,i,s,l;return a("div",{className:"max-w-lg bg-white border border-gray-200 rounded-lg shadow h-full",children:n("div",{className:"flex flex-col p-5 h-full",children:[a("h5",{className:"mb-1 text-xl font-semibold text-gray-900",children:e.book_name}),a("div",{className:"py-2 flex-1",children:n("ul",{className:"flex itmes-center   gap-2 mb-2",children:[n("li",{className:"mb-2 text-gray-700",children:[a("strong",{className:"text-gray-700",children:"الكاتب:"})," ",e.author_name]}),n("li",{className:"mb-2 text-gray-700",children:[a("strong",{className:"text-gray-700",children:"رقم الطبعة:"})," ",e.edition_number]}),n("li",{className:"text-gray-700",children:[a("strong",{className:"text-gray-700",children:"رقم المجلد:"})," ",e.volume_number]})]})}),n("div",{className:"flex items-center justify-center flex-wrap gap-2",children:[a("input",{onChange:r=>z(r,e.id),type:"number",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((t=o.find(r=>r.book_id===e.id))==null?void 0:t.qty)||"",placeholder:"الكمية"}),a("input",{onChange:r=>G(r,e.id),type:"number",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((i=o.find(r=>r.book_id===e.id))==null?void 0:i.price)||"",placeholder:"السعر"}),a("input",{onChange:r=>H(r,e.id),type:"text",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((s=o.find(r=>r.book_id===e.id))==null?void 0:s.offer)||"",placeholder:"عرض إضافي"}),n("div",{className:"py-4 flex items-center justify-between gap-2 w-full",children:[n("label",{className:"flex  items-center justify-center w-full  py-2 px-4 border border-gray-300 rounded-md shadow-sm transition duration-300 focus:border-indigo-500 focus:ring-indigo-500 hover:border-indigo-500 focus:outline-none hover:cursor-pointer",children:[n("div",{className:"flex flex-col items-center gap-1",children:[a("span",{className:"mr-2",children:"أختر صورة الأعلان"}),a("span",{className:"text-xs text-gray-400 font-semibold mr-2",children:"حجم الصورة يجب ان يكون 2 MB"})]}),a("input",{name:"adImage",onChange:r=>J(r,e.id),type:"file",className:"hidden"})]}),a("div",{className:" whitespace-nowrap",children:(l=o.find(r=>r.book_id===e.id))!=null&&l.ad_image?a(y,{className:"py-5",onClick:r=>O(r,e.id),children:"حذف الاعلان"}):null})]})]}),n("div",{className:"flex pt-2",children:[n("div",{className:"flex-1",children:[!u.some(r=>r.book_id==e.id)&&a(y,{onClick:()=>M(e.id),children:"أضف"}),u.some(r=>r.book_id==e.id)&&a(X,{onClick:r=>F(r,e.id),children:"تحديث"})]}),o.some(r=>r.book_id===e.id)&&a("div",{children:o.some(r=>r.book_id===e.id&&r.deleted_at===null)?a(C,{onClick:r=>Q(r,e.id),children:"حذف"}):a(C,{onClick:r=>W(r,e.id),children:"إستعادة"})})]})]})},e.id)})}),a(Z,{links:v.links})]})})]})]})]})}export{ue as default};
