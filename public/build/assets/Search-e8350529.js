import{q as T,r as m,W as $,j as a,a as s,b as q,g as B}from"./app-7ced1f69.js";import{A as U}from"./AuthenticatedLayout-e438061e.js";import{d as W}from"./debounce-d0b43fed.js";import z from"./Pagination-e3d4b08a.js";import{m as F}from"./moment-with-locales-401807b1.js";import"./AdminAuthenticatedHeader-cab090c3.js";import"./ApplicationLogo-59c374e1.js";import"./transition-529127ea.js";import"./AuthenticatedLibraryHeader-4d8f2c2f.js";function I({auth:g,note:d,stationeries:h,cities:f,districts:y}){const{props:{filters:p,currentPage:b}}=T(),[N,v]=m.useState(""),[w,G]=m.useState({}),[n,C]=m.useState({}),[_,S]=m.useState(null),{data:i,setData:x,get:k}=$({search:p.search,city:p.city,district:p.district}),P=(e,r)=>{C(l=>l[r]&&l[r].some(t=>t.id===e.id)?{...l,[r]:l[r].filter(t=>t.id!==e.id)}:{...l,[r]:[...l[r]||[],e]})},M=e=>{const r=d.number_of_pages||0;return(n[e]||[]).reduce((c,o)=>{const E=o.per_page?o.price*Math.ceil(r/o.per_page):o.price*r;return c+E},0)},O=(e,r,l,t,c)=>{B.post(route("stationery.order.store",{note:e,stationery:r,totalPrice:l,selectedPages:t,selectedOptions:c,branch:_}))},A=()=>{k(route("search.stationeries.index",{note:d,search:i.search,city:i.city,district:i.district,page:b}),{preserveScroll:!0,preserveState:!0,replace:!0})},u=m.useCallback(W(A,500),[i.search,i.city,i.district,b]);m.useEffect(()=>(u(),u.cancel),[i.search,i.city,i.district,u]);const Y=e=>{var t,c;const r=e.target.value,l=f.filter(o=>r==o.name);v((t=l[0])==null?void 0:t.id),x("city",(c=l[0])==null?void 0:c.name)},j=e=>{x("district",e.target.value)},D=e=>{S(e.target.value)};return a(U,{user:g.user,children:[s(q,{title:"البحث عن الكتب"}),s("div",{className:"py-2",children:a("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[a("div",{className:"w-full sm:inline-flex ml-4 items-center gap-3 px-6 ",children:[s("input",{value:i.search||"",onChange:e=>x("search",e.target.value),type:"text",className:"w-full sm:max-w-xl  border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",placeholder:"أبحث بإسم القرطاسية"}),s("div",{className:"mb-2",children:a("select",{onChange:Y,value:i.city||"",name:"city",id:"city",className:"mt-2 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",children:[s("option",{value:"",children:"أختر المدينة"}),f.map(e=>s("option",{value:e.name,children:e.name},e.id))]})}),s("div",{className:"mb-2",children:a("select",{onChange:j,value:i.district||"",name:"district",id:"district",className:"mt-2 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",children:[s("option",{value:"",children:"أختر الحي"}),y.filter(e=>e.city_id===N).map(e=>s("option",{value:e.name,children:e.name},e.id))]})})]}),s("div",{className:"overflow-hidden sm:rounded-lg",children:a("div",{className:"p-6 text-gray-900",children:[a("div",{className:"container mx-auto grid grid-cols-1 sm:grid-cols-1  gap-4",children:[s("div",{className:"grid grid-cols-1 gap-4",children:a("div",{className:"bg-indigo-50 border-2 border-indigo-300 p-4 rounded-md ",children:[a("div",{className:"flex flex-col gap-2",children:[a("div",{className:"flex flex-col gap-4 sm:flex-row items-center",children:[a("h1",{className:"text-xl text-indigo-800",children:[s("span",{className:"font-semibold text-indigo-700",children:"المذكرة المراد طباعاتها :"}),a("span",{children:[" ",d.name," "]})]}),a("h1",{className:"text-xl text-indigo-800",children:[s("span",{className:"font-semibold text-indigo-700",children:"عدد صفحات المذكرة :"}),a("span",{children:[" ",d.number_of_pages,"  صفحة"]})]})]}),a("h4",{children:[s("span",{className:"text-sm text-indigo-500",children:F(d.created_at).locale("ar").format("MMMM Do YYYY")}),s("span",{children:" - "}),s("span",{className:"text-sm text-indigo-500",children:d.user.username})]})]}),s("div",{className:"py-4",children:s("p",{className:"text-indigo-800",children:d.description})})]})}),!h.data.length&&s("div",{children:s("h1",{className:"text-center sm:text-right text-lg sm:text-xl text-gray-900",children:"لا يوجد تطابق لبحثك، حاول مره اخرى!"})}),h.data.map(e=>{const r=g.user.city===e.city&&g.user.district===e.district,l=M(e.id);return a("div",{className:"bg-white p-4 md:p-8 rounded-md shadow-md",children:[a("div",{className:"flex flex-col md:flex-row md:items-center gap-4 md:gap-6",children:[a("h1",{className:"text-xl text-gray-800",children:[s("span",{className:"font-semibold text-gray-700",children:"إسم القرطاسية "}),s("span",{children:e.name})]}),a("h1",{className:"text-xl text-gray-800",children:[s("span",{className:"font-semibold text-gray-700",children:"المدينة "}),a("span",{children:[e.city," ",r&&s("span",{className:"inline-block bg-green-200 text-green-800 px-2 py-1 text-xs font-bold rounded-full",children:"في مدينتك"})]})]}),a("h1",{className:"text-xl text-gray-800",children:[s("span",{className:"font-semibold text-gray-700",children:"الحي "}),a("span",{children:[e.district,r&&s("span",{className:"inline-block bg-green-200 text-green-800 px-2 py-1 text-xs font-bold rounded-full",children:"في الحي"})]}),"                                                "]})]}),a("div",{className:"pt-6 flex flex-col gap-4",children:[e.branches.length>0&&a("select",{onChange:D,className:"block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",name:"branch",id:"branch",children:[s("option",{value:"",children:"إختر فرع القرطاسية - أو الفرع الرئيسي"}),e.branches.map(t=>s("option",{value:t.id,children:t.name+" - "+t.city+" - "+t.district},t.id))]}),e.printing_options.map(t=>a("div",{className:"flex flex-col md:flex-row md:items-center gap-3 text-lg md:text-xl text-gray-800",children:[a("div",{className:"w-full md:w-96 flex items-center gap-3 ",children:[a("span",{className:"font-semibold text-gray-700",children:[t.display_name,"  ",t.per_page>0&&s("span",{className:"inline-block bg-green-300 text-green-900 px-2 py-1 text-xs font-bold rounded-full",children:t.per_page>0?`${t.per_page} صفحات  `:""})]}),a("span",{children:[t.price," ريال"]})]}),s("div",{className:"w-full md:w-36 flex items-center ",children:s("div",{className:"w-full md:w-36 flex items-center ",children:s("button",{onClick:()=>P(t,e.id),className:"px-2 py-1 bg-blue-500 text-white rounded disabled:bg-gray-400",children:n[e.id]&&Array.isArray(n[e.id])&&n[e.id].some(c=>c.id===t.id)?"تم الإختيار":"إختيار"})})})]},t.id)),a("div",{className:"flex items-center gap-2 mt-3 text-xl text-gray-800",children:[s("span",{className:"text-xl font-semibold text-gray-600",children:"إجمالي السعر"}),a("span",{className:"text-indigo-500",children:[" ",l," ريال"]})]}),s("button",{onClick:()=>O(d.id,e.id,l,w[e.id],n[e.id]),className:`px-2 py-1 bg-blue-500 text-white rounded disabled:bg-gray-400
                                                                ${n[e.id]?"w-fit":"bg-gray-500 cursor-not-allowed w-fit"}`,disabled:!n[e.id]||l===0,children:" إرسال الطلب "})]})]},e.id)})]}),s(z,{class:"mt-6",links:h.links})]})})]})})]})}export{I as default};
