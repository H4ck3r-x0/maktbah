import{q as M,W as Z,r as c,j as t,a as i,d as $,b as k,g as h}from"./app-7355fa36.js";import{P as f}from"./PrimaryButton-d324a9fe.js";import{A as ee}from"./AuthenticatedLayout-510cd8a3.js";import{D as y}from"./DangerButton-795cc9cb.js";import{S as F}from"./SecondaryButton-22424c36.js";import{d as re}from"./debounce-b63c2ecd.js";import ie from"./Pagination-8e050b14.js";import{I as ae,_ as b}from"./index-926f2809.js";import"./AdminAuthenticatedHeader-4195689c.js";import"./ApplicationLogo-50054e7e.js";import"./transition-1802807a.js";import"./AuthenticatedLibraryHeader-8212a420.js";function pe({auth:O,books:N,addedBooks:o}){const Q=M().props.filters,w=M().props.currentPage,{data:g,setData:W,get:z}=Z({search:Q.search}),[p,G]=c.useState(!1),[n,u]=c.useState([]),[C,H]=c.useState(""),[S,J]=c.useState(""),[K,R]=c.useState(""),[q,v]=c.useState(null);c.useEffect(()=>{o.length>0&&u(o)},[o]);const T=e=>{W("search",e.target.value)},U=()=>{z(route("branch.book.create",{search:g.search,page:w}),{preserveScroll:!0,preserveState:!0,replace:!0})},_=c.useCallback(re(U,500),[g.search,w]);c.useEffect(()=>(_(),_.cancel),[g.search,_]);const B=(e,a)=>{e.preventDefault();const{book_id:s,qty:l,price:d,offer:r}=n.filter(m=>m.book_id===a)[0];h.post(route("branch.book.update",a),{book_id:s,qty:l,price:d,offer:r,ad_image:q},{preserveScroll:!0,onError:m=>{let x="";m.ad_image&&(v(null),x=m.ad_image),m.price&&(x=m.price),m.qty&&(x=m.qty),b.error(x,{duration:4e3,position:"top-center",className:"",ariaProps:{role:"status","aria-live":"polite"}})}})},j=e=>{if(S===""||C===""){b.error("الرجاء اكمال جميع بيانات الكتاب",{duration:4e3,position:"top-center",className:"",ariaProps:{role:"status","aria-live":"polite"}});return}h.post(route("branch.book.store"),{book_id:e,qty:C,price:S,offer:K,ad_image:q},{preserveScroll:!0,onError:a=>{let s="";a.ad_image&&(v(null),s=a.ad_image),a.price&&(s=a.price),a.qty&&(s=a.qty),b.error(s,{duration:4e3,position:"top-center",className:"",ariaProps:{role:"status","aria-live":"polite"}})}})},P=(e,a)=>{e.preventDefault(),h.delete(route("branch.book.deleteBookAdImage",a),{preserveScroll:!0,onSuccess:()=>{}})},A=(e,a)=>{e.preventDefault(),h.delete(route("branch.book.destroy",a),{preserveScroll:!0,onSuccess:()=>{u(s=>s.filter(l=>l.book_id!==a))}})},I=(e,a)=>{e.preventDefault(),h.post(route("branch.book.restore",a),{preserveScroll:!0,onSuccess:()=>{u(s=>s.filter(l=>l.book_id!==a))}})},V=(e,a)=>{const{value:s}=e.target;H(s),s!==""&&u(l=>l.map(d=>d.book_id===a?{...d,qty:s}:d))},D=(e,a)=>{const{value:s}=e.target;J(s),s!==""&&u(l=>l.map(d=>d.book_id===a?{...d,price:s}:d))},E=(e,a)=>{const{value:s}=e.target;R(s),s!==""&&u(l=>l.map(d=>d.book_id===a?{...d,offer:s}:d))},L=(e,a)=>{v(e.target.files[0]),e.target.files[0]&&u(s=>s.map(l=>l.book_id===a?{...l,ad_image:e.target.files[0]}:l))},X=o.map(e=>e.book_id),Y=N.data.filter(e=>X.includes(e.id));return t(ee,{user:O.user,header:t("div",{className:"flex items-center justify-between",children:[i("h2",{className:"flex flex-col gap-2 font-semibold text-xl text-gray-800 leading-tight",children:i("span",{children:"إضافة كتاب جديد"})}),i($,{href:route("library.dashboard"),children:i(f,{children:"العودة"})})]}),children:[i(k,{title:"إضافة كتاب جديد"}),t("div",{className:"py-4",children:[i(ae,{}),t("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[t("div",{className:"w-full flex flex-col items-center sm:flex-row gap-3 px-6",children:[i("input",{className:" w-full sm:w-1/2  border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",type:"text",id:"search",name:"search",value:g.search||"",onChange:T,autoFocus:!0,placeholder:"ابحث بإسم الكتاب او الكاتب ..."}),i(f,{onClick:()=>G(!p),children:p===!1?"إظهار الكتب المظافة":"إخفاء الكتب المظافة"})]}),i("div",{className:" overflow-hidden sm:rounded-lg",children:t("div",{className:"p-6 text-gray-900",children:[t("div",{className:"grid grid-cols-1 sm:grid-cols-2  gap-3",children:[p&&Y.map(e=>{var a,s,l,d;return i("div",{className:"max-w-lg bg-white border border-gray-200 rounded-lg shadow h-full",children:t("div",{className:"flex flex-col p-5 h-full",children:[i("h5",{className:"mb-1 text-xl font-semibold text-gray-900",children:e.book_name}),i("div",{className:"py-2 flex-1",children:t("ul",{className:"flex itmes-center   gap-2 mb-2",children:[t("li",{className:"mb-2 text-gray-700",children:[i("strong",{className:"text-gray-700",children:"الكاتب:"})," ",e.author_name]}),t("li",{className:"mb-2 text-gray-700",children:[i("strong",{className:"text-gray-700",children:"رقم الطبعة:"})," ",e.edition_number]}),t("li",{className:"text-gray-700",children:[i("strong",{className:"text-gray-700",children:"رقم المجلد:"})," ",e.volume_number]})]})}),t("div",{className:"flex items-center justify-center flex-wrap gap-2",children:[i("input",{onChange:r=>V(r,e.id),type:"number",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((a=n.find(r=>r.book_id===e.id))==null?void 0:a.qty)||"",placeholder:"الكمية"}),i("input",{onChange:r=>D(r,e.id),type:"number",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((s=n.find(r=>r.book_id===e.id))==null?void 0:s.price)||"",placeholder:"السعر"}),i("input",{onChange:r=>E(r,e.id),type:"text",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((l=n.find(r=>r.book_id===e.id))==null?void 0:l.offer)||"",placeholder:"عرض إضافي"}),t("div",{className:"py-4 flex items-center justify-between gap-2 w-full",children:[t("label",{className:"flex  items-center justify-center w-full  py-2 px-4 border border-gray-300 rounded-md shadow-sm transition duration-300 focus:border-indigo-500 focus:ring-indigo-500 hover:border-indigo-500 focus:outline-none hover:cursor-pointer",children:[t("div",{className:"flex flex-col items-center gap-1",children:[i("span",{className:"mr-2",children:"أختر صورة الأعلان"}),i("span",{className:"text-xs text-gray-400 font-semibold mr-2",children:"حجم الصورة يجب ان يكون 2 MB"})]}),i("input",{name:"adImage",onChange:r=>L(r,e.id),type:"file",className:"hidden"})]}),i("div",{className:" whitespace-nowrap",children:(d=n.find(r=>r.book_id===e.id))!=null&&d.ad_image?i(f,{className:"py-5",onClick:r=>P(r,e.id),children:"حذف الاعلان"}):null})]})]}),t("div",{className:"flex pt-2",children:[t("div",{className:"flex-1",children:[!o.some(r=>r.book_id==e.id)&&i(f,{onClick:()=>j(e.id),children:"أضف"}),o.some(r=>r.book_id==e.id)&&i(F,{onClick:r=>B(r,e.id),children:"تحديث"})]}),n.some(r=>r.book_id===e.id)&&i("div",{children:n.some(r=>r.book_id===e.id&&r.deleted_at===null)?i(y,{onClick:r=>A(r,e.id),children:"حذف"}):i(y,{onClick:r=>I(r,e.id),children:"إستعادة"})})]})]})},e.id)}),!p&&N.data.map(e=>{var a,s,l,d;return i("div",{className:"max-w-lg bg-white border border-gray-200 rounded-lg shadow h-full",children:t("div",{className:"flex flex-col p-5 h-full",children:[i("h5",{className:"mb-1 text-xl font-semibold text-gray-900",children:e.book_name}),i("div",{className:"py-2 flex-1",children:t("ul",{className:"flex itmes-center   gap-2 mb-2",children:[t("li",{className:"mb-2 text-gray-700",children:[i("strong",{className:"text-gray-700",children:"الكاتب:"})," ",e.author_name]}),t("li",{className:"mb-2 text-gray-700",children:[i("strong",{className:"text-gray-700",children:"رقم الطبعة:"})," ",e.edition_number]}),t("li",{className:"text-gray-700",children:[i("strong",{className:"text-gray-700",children:"رقم المجلد:"})," ",e.volume_number]})]})}),t("div",{className:"flex items-center justify-center flex-wrap gap-2",children:[i("input",{onChange:r=>V(r,e.id),type:"number",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((a=n.find(r=>r.book_id===e.id))==null?void 0:a.qty)||"",placeholder:"الكمية"}),i("input",{onChange:r=>D(r,e.id),type:"number",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((s=n.find(r=>r.book_id===e.id))==null?void 0:s.price)||"",placeholder:"السعر"}),i("input",{onChange:r=>E(r,e.id),type:"text",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((l=n.find(r=>r.book_id===e.id))==null?void 0:l.offer)||"",placeholder:"عرض إضافي"}),t("div",{className:"py-4 flex items-center justify-between gap-2 w-full",children:[t("label",{className:"flex  items-center justify-center w-full  py-2 px-4 border border-gray-300 rounded-md shadow-sm transition duration-300 focus:border-indigo-500 focus:ring-indigo-500 hover:border-indigo-500 focus:outline-none hover:cursor-pointer",children:[t("div",{className:"flex flex-col items-center gap-1",children:[i("span",{className:"mr-2",children:"أختر صورة الأعلان"}),i("span",{className:"text-xs text-gray-400 font-semibold mr-2",children:"حجم الصورة يجب ان يكون 2 MB"})]}),i("input",{name:"adImage",onChange:r=>L(r,e.id),type:"file",className:"hidden"})]}),i("div",{className:" whitespace-nowrap",children:(d=n.find(r=>r.book_id===e.id))!=null&&d.ad_image?i(f,{className:"py-5",onClick:r=>P(r,e.id),children:"حذف الاعلان"}):null})]})]}),t("div",{className:"flex pt-2",children:[t("div",{className:"flex-1",children:[!o.some(r=>r.book_id==e.id)&&i(f,{onClick:()=>j(e.id),children:"أضف"}),o.some(r=>r.book_id==e.id)&&i(F,{onClick:r=>B(r,e.id),children:"تحديث"})]}),n.some(r=>r.book_id===e.id)&&i("div",{children:n.some(r=>r.book_id===e.id&&r.deleted_at===null)?i(y,{onClick:r=>A(r,e.id),children:"حذف"}):i(y,{onClick:r=>I(r,e.id),children:"إستعادة"})})]})]})},e.id)})]}),i(ie,{links:N.links})]})})]})]})]})}export{pe as default};
