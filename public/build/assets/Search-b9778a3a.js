import{q as T,r as o,W as q,j as a,a as s,b as B,f as U}from"./app-533a8615.js";import{A as W}from"./AuthenticatedLayout-d45db153.js";import{d as $}from"./debounce-3c7b23b5.js";import z from"./Pagination-6571cc00.js";import{m as F}from"./moment-with-locales-08b71015.js";import"./AdminAuthenticatedHeader-87ede515.js";import"./ApplicationLogo-2729fa4e.js";import"./transition-86f90554.js";import"./AuthenticatedLibraryHeader-97b2d569.js";function I({auth:h,note:d,stationeries:g,cities:f,districts:y}){const{props:{filters:x,currentPage:b}}=T(),[N,v]=o.useState(""),[w,G]=o.useState({}),[n,C]=o.useState({}),[S,k]=o.useState(null),{data:i,setData:p,get:P}=q({search:x.search,city:x.city,district:x.district}),_=(e,r)=>{C(l=>l[r]&&l[r].some(t=>t.id===e.id)?{...l,[r]:l[r].filter(t=>t.id!==e.id)}:{...l,[r]:[...l[r]||[],e]})},M=e=>{const r=d.number_of_pages||0;return(n[e]||[]).reduce((c,m)=>{const E=m.price*Math.ceil(r/m.per_page);return c+E},0)},O=(e,r,l,t,c)=>{U.post(route("stationery.order.store",{note:e,stationery:r,totalPrice:l,selectedPages:t,selectedOptions:c,branch:S}))},A=()=>{P(route("search.stationeries.index",{note:d,search:i.search,city:i.city,district:i.district,page:b}),{preserveScroll:!0,preserveState:!0,replace:!0})},u=o.useCallback($(A,500),[i.search,i.city,i.district,b]);o.useEffect(()=>(u(),u.cancel),[i.search,i.city,i.district,u]);const Y=e=>{var t,c;const r=e.target.value,l=f.filter(m=>r==m.name);v((t=l[0])==null?void 0:t.id),p("city",(c=l[0])==null?void 0:c.name)},j=e=>{p("district",e.target.value)},D=e=>{k(e.target.value)};return a(W,{user:h.user,children:[s(B,{title:"البحث عن الكتب"}),s("div",{className:"py-2",children:a("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[a("div",{className:"w-full sm:inline-flex ml-4 items-center gap-3 px-6 ",children:[s("input",{value:i.search||"",onChange:e=>p("search",e.target.value),type:"text",className:"w-full sm:max-w-xl  border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",placeholder:"إبحث بإسم الكتاب او المؤلف ..."}),s("div",{className:"mb-2",children:a("select",{onChange:Y,value:i.city||"",name:"city",id:"city",className:"mt-2 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",children:[s("option",{value:"",children:"أختر المدينة"}),f.map(e=>s("option",{value:e.name,children:e.name},e.id))]})}),s("div",{className:"mb-2",children:a("select",{onChange:j,value:i.district||"",name:"district",id:"district",className:"mt-2 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",children:[s("option",{value:"",children:"أختر الحي"}),y.filter(e=>e.city_id===N).map(e=>s("option",{value:e.name,children:e.name},e.id))]})})]}),s("div",{className:"overflow-hidden sm:rounded-lg",children:a("div",{className:"p-6 text-gray-900",children:[a("div",{className:"container mx-auto grid grid-cols-1 sm:grid-cols-1  gap-4",children:[s("div",{className:"grid grid-cols-1 gap-4",children:a("div",{className:"bg-indigo-50 border-2 border-indigo-300 p-4 rounded-md ",children:[a("div",{className:"flex flex-col gap-2",children:[a("div",{className:"flex flex-col gap-4 sm:flex-row items-center",children:[a("h1",{className:"text-xl text-indigo-800",children:[s("span",{className:"font-semibold text-indigo-700",children:"المذكرة المراد طباعاتها :"}),a("span",{children:[" ",d.name," "]})]}),a("h1",{className:"text-xl text-indigo-800",children:[s("span",{className:"font-semibold text-indigo-700",children:"عدد صفحات المذكرة :"}),a("span",{children:[" ",d.number_of_pages,"  صفحة"]})]})]}),a("h4",{children:[s("span",{className:"text-sm text-indigo-500",children:F(d.created_at).locale("ar").format("MMMM Do YYYY")}),s("span",{children:" - "}),s("span",{className:"text-sm text-indigo-500",children:d.user.username})]})]}),s("div",{className:"py-4",children:s("p",{className:"text-indigo-800",children:d.description})})]})}),!g.data.length&&s("div",{children:s("h1",{className:"text-center sm:text-right text-lg sm:text-xl text-gray-900",children:"لا يوجد تطابق لبحثك، حاول مره اخرى!"})}),g.data.map(e=>{const r=h.user.city===e.city&&h.user.district===e.district,l=M(e.id);return a("div",{className:"bg-white p-4 md:p-8 rounded-md shadow-md",children:[a("div",{className:"flex flex-col md:flex-row md:items-center gap-4 md:gap-6",children:[a("h1",{className:"text-xl text-gray-800",children:[s("span",{className:"font-semibold text-gray-700",children:"إسم القرطاسية "}),s("span",{children:e.name})]}),a("h1",{className:"text-xl text-gray-800",children:[s("span",{className:"font-semibold text-gray-700",children:"المدينة "}),a("span",{children:[e.city," ",r&&s("span",{className:"inline-block bg-green-200 text-green-800 px-2 py-1 text-xs font-bold rounded-full",children:"في مدينتك"})]})]}),a("h1",{className:"text-xl text-gray-800",children:[s("span",{className:"font-semibold text-gray-700",children:"الحي "}),a("span",{children:[e.district,r&&s("span",{className:"inline-block bg-green-200 text-green-800 px-2 py-1 text-xs font-bold rounded-full",children:"في الحي"})]}),"                                                "]})]}),a("div",{className:"pt-6 flex flex-col gap-4",children:[e.branches.length>0&&a("select",{onChange:D,className:"block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",name:"branch",id:"branch",children:[s("option",{value:"",children:"إختر فرع القرطاسية - أو الفرع الرئيسي"}),e.branches.map(t=>s("option",{value:t.id,children:t.name+" - "+t.city+" - "+t.district},t.id))]}),e.printing_options.map(t=>a("div",{className:"flex flex-col md:flex-row md:items-center gap-3 text-lg md:text-xl text-gray-800",children:[a("div",{className:"w-full md:w-96 flex items-center gap-3 ",children:[a("span",{className:"font-semibold text-gray-700",children:[t.display_name," - ( ",t.per_page,"  صفحات )"]}),a("span",{children:[t.price," ريال"]})]}),s("div",{className:"w-full md:w-36 flex items-center ",children:s("div",{className:"w-full md:w-36 flex items-center ",children:s("button",{onClick:()=>_(t,e.id),className:"px-2 py-1 bg-blue-500 text-white rounded disabled:bg-gray-400",children:n[e.id]&&Array.isArray(n[e.id])&&n[e.id].some(c=>c.id===t.id)?"تم الإختيار":"إختيار"})})})]},t.id)),a("div",{className:"flex items-center gap-2 mt-3 text-xl text-gray-800",children:[s("span",{className:"text-xl font-semibold text-gray-600",children:"إجمالي السعر"}),a("span",{className:"text-indigo-500",children:[" ",l," ريال"]})]}),s("button",{onClick:()=>O(d.id,e.id,l,w[e.id],n[e.id]),className:`px-2 py-1 bg-blue-500 text-white rounded disabled:bg-gray-400 
                                                    ${n[e.id]?"w-fit":"bg-gray-500 cursor-not-allowed w-fit"}`,disabled:!n[e.id]||l===0,children:" إرسال الطلب "})]})]},e.id)})]}),s(z,{class:"mt-6",links:g.links})]})})]})})]})}export{I as default};
