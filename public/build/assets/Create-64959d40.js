import{q as P,W as K,r as o,j as n,a,d as R,b as T,g as f}from"./app-46ddea15.js";import{P as x}from"./PrimaryButton-ebbdee38.js";import{A as U}from"./AuthenticatedLayout-c49cbd1d.js";import{D as j}from"./DangerButton-f0fd5930.js";import{S as X}from"./SecondaryButton-d57ae65e.js";import{d as Y}from"./debounce-245ca3a8.js";import Z from"./Pagination-95511367.js";import{I as $,_ as v}from"./index-96f4da22.js";import"./AdminAuthenticatedHeader-46c0c6ec.js";import"./ApplicationLogo-172f1c5f.js";import"./transition-60953b8d.js";import"./AuthenticatedLibraryHeader-008b1e61.js";function ue({auth:A,books:N,addedBooks:u}){const D=P().props.filters,_=P().props.currentPage,{data:p,setData:E,get:I}=K({search:D.search}),[c,m]=o.useState([]),[b,w]=o.useState(""),[S,C]=o.useState(""),[k,q]=o.useState(""),[B,g]=o.useState(null);o.useEffect(()=>{u.length>0&&m(u)},[u]);const V=e=>{E("search",e.target.value)},L=()=>{I(route("book.create",{search:p.search,page:_}),{preserveScroll:!0,preserveState:!0,replace:!0})},y=o.useCallback(Y(L,500),[p.search,_]);o.useEffect(()=>(y(),y.cancel),[p.search,y]);const F=(e,t)=>{e.preventDefault();const{book_id:i,qty:s,price:l,offer:r}=c.filter(d=>d.book_id===t)[0];f.post(route("book.update",t),{book_id:i,qty:s,price:l,offer:r,ad_image:B},{preserveScroll:!0,onError:d=>{let h="";d.ad_image&&(g(null),h=d.ad_image),d.price&&(h=d.price),d.qty&&(h=d.qty),v.error(h,{duration:4e3,position:"top-center",className:"",ariaProps:{role:"status","aria-live":"polite"}})}})},M=e=>{if(S===""||b===""){v.error("الرجاء اكمال جميع بيانات الكتاب",{duration:4e3,position:"top-center",className:"",ariaProps:{role:"status","aria-live":"polite"}});return}f.post(route("book.store"),{book_id:e,qty:b,price:S,offer:k,ad_image:B},{preserveScroll:!0,onSuccess:()=>{g(null),C(""),q(""),w("")},onError:t=>{let i="";t.ad_image&&(g(null),i=t.ad_image),t.price&&(i=t.price),t.qty&&(i=t.qty),v.error(i,{duration:4e3,position:"top-center",className:"",ariaProps:{role:"status","aria-live":"polite"}})}})},O=(e,t)=>{e.preventDefault(),f.delete(route("book.deleteBookAdImage",t),{preserveScroll:!0,onSuccess:()=>{}})},Q=(e,t)=>{e.preventDefault(),f.delete(route("book.destroy",t),{preserveScroll:!0,onSuccess:()=>{m(i=>i.filter(s=>s.book_id!==t))}})},W=(e,t)=>{e.preventDefault(),f.post(route("book.restore",t),{preserveScroll:!0,onSuccess:()=>{m(i=>i.filter(s=>s.book_id!==t))}})},z=(e,t)=>{const{value:i}=e.target;w(i),i!==""&&m(s=>s.map(l=>l.book_id===t?{...l,qty:i}:l))},G=(e,t)=>{const{value:i}=e.target;C(i),i!==""&&m(s=>s.map(l=>l.book_id===t?{...l,price:i}:l))},H=(e,t)=>{const{value:i}=e.target;q(i),i!==""&&m(s=>s.map(l=>l.book_id===t?{...l,offer:i}:l))},J=(e,t)=>{g(e.target.files[0]),e.target.files[0]&&m(i=>i.map(s=>s.book_id===t?{...s,ad_image:e.target.files[0]}:s))};return n(U,{user:A.user,header:n("div",{className:"flex items-center justify-between",children:[a("h2",{className:"flex flex-col gap-2 font-semibold text-xl text-gray-800 leading-tight",children:a("span",{children:"إضافة كتاب جديد"})}),a(R,{href:route("library.dashboard"),children:a(x,{children:"العودة"})})]}),children:[a(T,{title:"إضافة كتاب جديد"}),n("div",{className:"py-4",children:[a($,{}),n("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[a("div",{className:" max-w-full  px-6 ",children:a("div",{className:"flex-1",children:a("input",{className:" w-full p-3 border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",type:"text",id:"search",name:"search",value:p.search||"",onChange:V,autoFocus:!0,placeholder:"ابحث بإسم الكتاب او الكاتب ..."})})}),a("div",{className:" overflow-hidden sm:rounded-lg",children:n("div",{className:"p-6 text-gray-900",children:[a("div",{className:"grid grid-cols-1 sm:grid-cols-2  gap-3",children:N.data.map(e=>{var t,i,s,l;return a("div",{className:"max-w-lg bg-white border border-gray-200 rounded-lg shadow h-full",children:n("div",{className:"flex flex-col p-5 h-full",children:[a("h5",{className:"mb-1 text-xl font-semibold text-gray-900",children:e.book_name}),a("div",{className:"py-2 flex-1",children:n("ul",{className:"flex itmes-center   gap-2 mb-2",children:[n("li",{className:"mb-2 text-gray-700",children:[a("strong",{className:"text-gray-700",children:"الكاتب:"})," ",e.author_name]}),n("li",{className:"mb-2 text-gray-700",children:[a("strong",{className:"text-gray-700",children:"رقم الطبعة:"})," ",e.edition_number]}),n("li",{className:"text-gray-700",children:[a("strong",{className:"text-gray-700",children:"رقم المجلد:"})," ",e.volume_number]})]})}),n("div",{className:"flex items-center justify-center flex-wrap gap-2",children:[a("input",{onChange:r=>z(r,e.id),type:"number",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((t=c.find(r=>r.book_id===e.id))==null?void 0:t.qty)||"",placeholder:"الكمية"}),a("input",{onChange:r=>G(r,e.id),type:"number",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((i=c.find(r=>r.book_id===e.id))==null?void 0:i.price)||"",placeholder:"السعر"}),a("input",{onChange:r=>H(r,e.id),type:"text",className:"w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",min:1,defaultValue:((s=c.find(r=>r.book_id===e.id))==null?void 0:s.offer)||"",placeholder:"عرض إضافي"}),n("div",{className:"py-4 flex items-center justify-between gap-2 w-full",children:[n("label",{className:"flex  items-center justify-center w-full  py-2 px-4 border border-gray-300 rounded-md shadow-sm transition duration-300 focus:border-indigo-500 focus:ring-indigo-500 hover:border-indigo-500 focus:outline-none hover:cursor-pointer",children:[n("div",{className:"flex flex-col items-center gap-1",children:[a("span",{className:"mr-2",children:"أختر صورة الأعلان"}),a("span",{className:"text-xs text-gray-400 font-semibold mr-2",children:"حجم الصورة يجب ان يكون 2 MB"})]}),a("input",{name:"adImage",onChange:r=>J(r,e.id),type:"file",className:"hidden"})]}),a("div",{className:" whitespace-nowrap",children:(l=c.find(r=>r.book_id===e.id))!=null&&l.ad_image?a(x,{className:"py-5",onClick:r=>O(r,e.id),children:"حذف الاعلان"}):null})]})]}),n("div",{className:"flex pt-2",children:[n("div",{className:"flex-1",children:[!u.some(r=>r.book_id==e.id)&&a(x,{onClick:()=>M(e.id),children:"أضف"}),u.some(r=>r.book_id==e.id)&&a(X,{onClick:r=>F(r,e.id),children:"تحديث"})]}),c.some(r=>r.book_id===e.id)&&a("div",{children:c.some(r=>r.book_id===e.id&&r.deleted_at===null)?a(j,{onClick:r=>Q(r,e.id),children:"حذف"}):a(j,{onClick:r=>W(r,e.id),children:"إستعادة"})})]})]})},e.id)})}),a(Z,{links:N.links})]})})]})]})]})}export{ue as default};
